import streamlit as st
import pandas as pd
import plotly.express as px

st.set_page_config(page_title="2024 ëŒ€í•œë¯¼êµ­ ì¢…í•©ì†Œë“ì„¸ ê³„ì‚°ê¸°", layout="wide")
st.title("ğŸ‡°ğŸ‡· 2024 ëŒ€í•œë¯¼êµ­ ì¢…í•©ì†Œë“ì„¸ ìë™í™” ì›¹ ì•±")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ì„¸ìœ¨ ê³„ì‚° í•¨ìˆ˜ (VBAì™€ ë™ì¼)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def calc_tax_2024(income_man):
    income = income_man * 10000
    if income <= 14_000_000:
        tax = income * 0.06
    elif income <= 50_000_000:
        tax = 14_000_000 * 0.06 + (income - 14_000_000) * 0.15
    elif income <= 88_000_000:
        tax = 14_000_000 * 0.06 + 36_000_000 * 0.15 + (income - 50_000_000) * 0.24
    elif income <= 150_000_000:
        tax = 14_000_000 * 0.06 + 36_000_000 * 0.15 + 38_000_000 * 0.24 + (income - 88_000_000) * 0.35
    elif income <= 300_000_000:
        tax = 14_000_000 * 0.06 + 36_000_000 * 0.15 + 38_000_000 * 0.24 + 62_000_000 * 0.35 + (income - 150_000_000) * 0.38
    elif income <= 500_000_000:
        tax = 14_000_000 * 0.06 + 36_000_000 * 0.15 + 38_000_000 * 0.24 + 62_000_000 * 0.35 + 150_000_000 * 0.38 + (income - 300_000_000) * 0.4
    elif income <= 1_000_000_000:
        tax = 14_000_000 * 0.06 + 36_000_000 * 0.15 + 38_000_000 * 0.24 + 62_000_000 * 0.35 + 150_000_000 * 0.38 + 200_000_000 * 0.4 + (income - 500_000_000) * 0.42
    else:
        tax = 14_000_000 * 0.06 + 36_000_000 * 0.15 + 38_000_000 * 0.24 + 62_000_000 * 0.35 + 150_000_000 * 0.38 + 200_000_000 * 0.4 + 500_000_000 * 0.42 + (income - 1_000_000_000) * 0.45
    return round(tax / 10000, 0)

def add_tax_columns(df):
    df["ì„¸ê¸ˆ(ë§Œì›)"] = df["ì—°ì†Œë“(ë§Œì›)"].apply(calc_tax_2024)
    df["ì„¸ìœ¨(%)"] = (df["ì„¸ê¸ˆ(ë§Œì›)"] / df["ì—°ì†Œë“(ë§Œì›)"] * 100).round(2)
    return df

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë°ì´í„° ë¡œë“œ & ì´ˆê¸° í‘œì‹œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
@st.cache_data
def load_data():
    df = pd.DataFrame({
        "ì´ë¦„": ["ê¹€ë¯¼ì¤€", "ì´ì„œìœ¤", "ë°•ì§€í˜¸", "ìµœì§€ìš°", "ì •í˜„ìš°"],
        "ì—°ì†Œë“(ë§Œì›)": [2800, 5200, 7500, 9500, 13000]
    })
    return add_tax_columns(df)

df = load_data()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ì‚¬ì´ë“œë°” ì…ë ¥
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.sidebar.header("ë°ì´í„° ì¶”ê°€")
name = st.sidebar.text_input("ì´ë¦„ ì…ë ¥")
income = st.sidebar.number_input("ì—°ì†Œë“ (ë§Œì›)", min_value=1000, max_value=20000, step=100)

if st.sidebar.button("ë°ì´í„° ì¶”ê°€"):
    new_row = pd.DataFrame({"ì´ë¦„": [name], "ì—°ì†Œë“(ë§Œì›)": [income]})
    df = pd.concat([df, new_row], ignore_index=True)
    df = add_tax_columns(df)
    st.session_state["data"] = df
    st.success(f"{name}ë‹˜ì˜ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë°ì´í„° í…Œì´ë¸”
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.subheader("ğŸ“‹ ë°ì´í„° í…Œì´ë¸”")
st.dataframe(df, use_container_width=True)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ìš”ì•½ ì •ë³´
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.subheader("ğŸ“Š ìš”ì•½ ì •ë³´")
col1, col2, col3 = st.columns(3)
col1.metric("ì´ ì¸ì›", len(df))
col2.metric("ì´ ì—°ì†Œë“(ë§Œì›)", int(df["ì—°ì†Œë“(ë§Œì›)"].sum()))
col3.metric("í‰ê·  ì„¸ìœ¨(%)", round(df["ì„¸ìœ¨(%)"].mean(), 2))

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# íŒŒì´ì°¨íŠ¸ (ì†Œë“ êµ¬ê°„ë³„)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
bins = [0, 3000, 5000, 8000, 12000, 20000]
labels = ["â‰¤3000", "3001~5000", "5001~8000", "8001~12000", ">12000"]
df["ì†Œë“êµ¬ê°„"] = pd.cut(df["ì—°ì†Œë“(ë§Œì›)"], bins=bins, labels=labels, include_lowest=True)

st.subheader("ğŸ¨ ì†Œë“ êµ¬ê°„ë³„ ì¸ì› ë¹„ìœ¨")
fig = px.pie(df, names="ì†Œë“êµ¬ê°„", title="ì—°ì†Œë“ êµ¬ê°„ ë¹„ìœ¨",
             color="ì†Œë“êµ¬ê°„",
             color_discrete_sequence=["#B0E0FF", "#FFF9A6", "#FFD6A5", "#FFA1A1", "#C7A6FF"])
st.plotly_chart(fig, use_container_width=True)
